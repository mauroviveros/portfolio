---
import { getCollection, render } from 'astro:content';
import { Image } from 'astro:assets';
import { Icon } from 'astro-icon/components';
import { useTranslations } from '@i18n';

const t = useTranslations(Astro.currentLocale);
const projects = await getCollection('projects');
if (projects.length === 0) return;
---

<section>
  <header>
    <h2>
      <Icon name="tabler:briefcase" />
      {t('sections.projects')}
    </h2>
  </header>

  <ul class="flex flex-col gap-8">
    {
      projects.map(async (project) => {
        const { title, techStack, repo, url, description } = project.data;
        const image = import(`../assets/projects/${project.id}.webp`);

        return (
          <li class="flex flex-col gap-8 lg:flex-row">
            {image && (
              <Image
                src={image}
                widths={[320, 480, 640]}
                sizes="(max-width: 768px) 100vw, 320px"
                class="w-120 rounded-lg object-cover"
                alt={title}
                loading="lazy"
                decoding="async"
              />
            )}

            <article class="flex flex-1 flex-col gap-4">
              <h3 class="text-foreground wrap-break-words shrink-0 truncate text-4xl font-bold">
                {title}
              </h3>

              <div class="text-foreground-light h-full w-full text-xl font-medium text-pretty">
                {description[(Astro.currentLocale as 'es' | 'en') || 'es']}
              </div>

              <ul class="flex gap-2">
                {techStack.map((tech) => (
                  <li>
                    <Icon name={`skill-icons:${tech}`} size="2rem" />
                  </li>
                ))}
              </ul>

              <nav class="flex gap-4">
                {repo && (
                  <a
                    href={repo}
                    target="_blank"
                    aria-label={t('label.repo', { title })}
                    class="btn bg-primary text-background-hover rounded-lg"
                  >
                    {t('btn.repo')} <Icon name="tabler:brand-github" size="1.5rem" />
                  </a>
                )}
                {url && (
                  <a
                    href={url}
                    target="_blank"
                    aria-label={t('label.demo', { title })}
                    class="btn bg-primary text-background-hover rounded-lg"
                  >
                    {t('btn.demo')} <Icon name="tabler:external-link" size="1.5rem" />
                  </a>
                )}
              </nav>
            </article>
          </li>
        );
      })
    }
  </ul>
</section>
